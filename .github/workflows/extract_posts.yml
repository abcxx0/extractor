name: Extraer Posts

on:
  workflow_dispatch:
  schedule:
    - cron: '0 12 * * 1'   # cada lunes a las 09:00 ðŸ‡¦ðŸ‡·

jobs:
  run-extractor:
    runs-on: ubuntu-latest

    steps:
      # 1â€†â€”â€†Clonar repositorio
      - name: Checkout
        uses: actions/checkout@v3

      # 2â€†â€”â€†Configurar Python
      - name: Configurar Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.11"

      # 3â€†â€”â€†Instalar dependencias
      - name: Instalar dependencias
        run: |
          pip install --upgrade pip
          pip install pandas requests tqdm unidecode

      # 4â€†â€”â€†Extraer posts
      - name: Ejecutar extractor
        run: python3 extract_posts.py

      # 5â€†â€”â€†Clasificar posts
      - name: Ejecutar clasificaciÃ³n
        run: python3 classify_posts.py

      # 6â€†â€”â€†Verificar quÃ© archivos se generaron
      - name: Verificar contenido del workspace
        run: |
          echo "ðŸ“‚ Contenido tras la clasificaciÃ³n:"
          pwd
          ls -R

      # 7â€†â€”â€†Subir CSV clasificado como artefacto
      - name: Subir CSV clasificado
        uses: actions/upload-artifact@v4
        with:
          name: datos-clasificados      # nombre del artefacto
          path: datos_clasificados.csv  # ruta al archivo
          if-no-files-found: error      # falla si no lo encuentra
